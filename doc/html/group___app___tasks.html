<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SBCDA Decoder Firmware: App_Tasks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SBCDA Decoder Firmware
   &#160;<span id="projectnumber">v1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">App_Tasks<div class="ingroups"><a class="el" href="group___s_b_c_d_a___a_p_p.html">SBCDA_APP</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac9a578724e7472c16d1c3192bd544f98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___app___tasks.html#gac9a578724e7472c16d1c3192bd544f98">Command_Parser_Task</a> (void *pvParameters)</td></tr>
<tr class="separator:gac9a578724e7472c16d1c3192bd544f98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadf0ceb656d8916064e56e3ea4f1dba35"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___app___tasks.html#gadf0ceb656d8916064e56e3ea4f1dba35">HouseKeeping_Task</a> (void *pvParameters)</td></tr>
<tr class="separator:gadf0ceb656d8916064e56e3ea4f1dba35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadfbb515047e6c4c679611a5cc618b88c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___app___tasks.html#gadfbb515047e6c4c679611a5cc618b88c">PTTDecoder_Task</a> (void *pvParameters)</td></tr>
<tr class="separator:gadfbb515047e6c4c679611a5cc618b88c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaccb4dfb0018e43c3697d98f4198bb845"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___app___tasks.html#gaccb4dfb0018e43c3697d98f4198bb845">ADCSampler_Task</a> (void *pvParameters)</td></tr>
<tr class="separator:gaccb4dfb0018e43c3697d98f4198bb845"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga85a0f311d8c7082245c3308cd9161e46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___app___tasks.html#ga85a0f311d8c7082245c3308cd9161e46">Idle_Task</a> (void *pvParameters)</td></tr>
<tr class="memdesc:ga85a0f311d8c7082245c3308cd9161e46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dummy task created for checking if RTOS is alive. The task simple blink SF2 board LEDs.  <a href="#ga85a0f311d8c7082245c3308cd9161e46">More...</a><br /></td></tr>
<tr class="separator:ga85a0f311d8c7082245c3308cd9161e46"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Application Tasks </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaccb4dfb0018e43c3697d98f4198bb845"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaccb4dfb0018e43c3697d98f4198bb845">&#9670;&nbsp;</a></span>ADCSampler_Task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ADCSampler_Task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>ADCSampler_Task</p>
<p>This task is responsible for collecting ADC Sampler windows (2048 adc samples) and storing them into the ADC Sampler Buffer. The ADC Sampler is high priority task, it can not be preempted while collecting a ADC window to avoid losing samples. It runs on a infinite loop alternating between two states:</p>
<pre><ul>
<li>ADC_IDLE: the tasks suspends for 0,5s, allowing other tasks to run;</li>
</ul>
</pre><pre><ul>
<li>ADC_BUSY: the tasks collects 2048 samples from the ADC Sampler FIFO
             in the Decoder Unit and stores them into a ADC Sampler Package.
             After the reading is done the tasks automatically switches to
             ADC_IDLE state.
 
   When the task is in ADC_BUSY state it is not preempted,
   therefore other critical process, such as the PTT Decoding Task,
   must be suspended before the ADC Sampler switches to ADC_BUSY. To
   initiate an ADC window read operation the on-board computer must put the
   firmware into Configuration Mode and then send the ADC_LOAD command.
   The task will be ADC_BUSY state for roughly 16ms and then switch
   back to ADC_IDLE. The on-board computer must issue the
   ADC_STATE command to know when the ADC reading is finished.</li>
</ul>
</pre><pre>ADCSampler_Task</pre><pre>It is responsible for collect ADC Sampler windows (2048 adc samples)
and  storing them into the ADC Sampler Buffer. The ADC Sampler
is high priority task, it  can not be preempted while collecting
a ADC window to avoid losing samples.
It runs on a infinite loop alternating between two states:</pre><pre><ul>
<li>ADC_IDLE: the tasks suspends for 0,5s, allowing other tasks to run;</li>
<li><p class="startli">ADC_BUSY: the tasks collects 2048 samples from the ADC Sampler FIFO
            in the Decoder Unit and stores them into a ADC Sampler Package.
            After the reading is done the tasks automatically switches to
            ADC_IDLE state.</p>
<p class="startli">When the task is in ADC_BUSY state it is not preempted,
  therefore other critical process, such as the PTT Decoding Task,
  must be suspended before the ADC Sampler switches to ADC_BUSY. To
  initiate an ADC window read operation the on-board computer must put the
  firmware into Configuration Mode and then send the ADC_LOAD command.
  The task will be ADC_BUSY state for roughly 16ms and then switch
  back to ADC_IDLE. The on-board computer must issue the
  ADC_STATE command to know when the ADC reading is finished.
</p>
</li>
</ul>
</pre>
<p class="definition">Definition at line <a class="el" href="adc__task_8c_source.html#l00043">43</a> of file <a class="el" href="adc__task_8c_source.html">adc_task.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="sbcda__decoder__app_8c_source.html#l00031">sbcda_decoder_app()</a>.</p>

</div>
</div>
<a id="gac9a578724e7472c16d1c3192bd544f98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac9a578724e7472c16d1c3192bd544f98">&#9670;&nbsp;</a></span>Command_Parser_Task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Command_Parser_Task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Command_Parser_Task</p>
<p>Task responsible for setting the current operation mode and its corresponding output package buffer. The Command Parser task is also responsible for executing configuration commands sent by the on-board computer. The result of each configuration command or request in configuration mode is a Configuration Data Package starting with the identifier byte 0x10. This task has low execution priority and can only run when the ADCSampler_Task and the PTTDecoder_Task are suspended. This behavior gives a small window of time for the on-board computer execute configuration commands or request HK information. Therefore, the on board computer must always check the type of a received data package (first byte) to be sure of which operation mode is currently set.</p>
<p>Command_Parser_Task </p>

<p class="definition">Definition at line <a class="el" href="cmd__task_8c_source.html#l00068">68</a> of file <a class="el" href="cmd__task_8c_source.html">cmd_task.c</a>.</p>

<p class="reference">References <a class="el" href="housekeeping__service_8c_source.html#l00097">HK_Get_Buffer()</a>, <a class="el" href="ptt__service_8c_source.html#l00134">PTT_GetReadyFifoOutput()</a>, and <a class="el" href="ptt_8h_source.html#l00028">PTT_TOTAL_RECORD_SIZE</a>.</p>

<p class="reference">Referenced by <a class="el" href="sbcda__decoder__app_8c_source.html#l00031">sbcda_decoder_app()</a>.</p>

</div>
</div>
<a id="gadf0ceb656d8916064e56e3ea4f1dba35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadf0ceb656d8916064e56e3ea4f1dba35">&#9670;&nbsp;</a></span>HouseKeeping_Task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void HouseKeeping_Task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>HouseKeeping_Task</p>
<p>This task constantly reads housekeeping information and keeps an updated Housekeeping Package. The collected information are defined by the Housekeeping "configuration
  word." The housekeeping information includes:</p>
<p>1 - RTC Current time tag; 2 - ADC 7894 current RMS value; 3 - Current sensors A and B updated values; 4 - PLL Synchronization flag; 5 - Over-current register flag;</p>
<p>The HK info is stored into a single HK Package, provided by the HK Service Layer. All Housekeeping measures are enabled by default. If the on-board computer deactivates one or more HK measures, their corresponding space is simply filled with zeros. The configuration word masks defines which HK measure is enabled or not. It can be updated by the on-board computer using the HK_CONFIG command with the firmware in Configuration Mode. The configuration word is a 2-byte integer whose bits are mapped as follows:</p>
<pre>
    0   - RTC time tag
    1   - Current sensors
    2   - ADC RMS
    3   - PLL Synch flag
    4   - Over - current
    5-15 - Reserved for future use
*</pre><p>HouseKeeping_Task</p>
<p>This task constantly reads housekeeping information and keeps an updated Housekeeping Package. The collected information are defined by the Housekeeping "configuration
word." The housekeeping information includes:</p>
<p>1 - RTC Current time tag; 2 - ADC 7894 current RMS value; 3 - Current sensors A and B updated values; 4 - PLL Synchronization flag; 5 - Over-current register flag;</p>
<p>The HK info is stored into a single HK Package, provided by the HK Service Layer. All Housekeeping measures are enabled by default. If the on-board computer deactivates one or more HK measures, their corresponding space is simply filled with zeros. The configuration word masks defines which HK measure is enabled or not. It can be updated by the on-board computer using the HK_CONFIG command with the firmware in Configuration Mode. The configuration word is a 2-byte integer whose bits are mapped as follows:</p>
<p>0 - RTC time tag 1 - Current sensors 2 - ADC RMS 3 - PLL Synch flag 4 - Over - current 5-15 - Reserved for future use </p>

<p class="definition">Definition at line <a class="el" href="hkp__task_8c_source.html#l00051">51</a> of file <a class="el" href="hkp__task_8c_source.html">hkp_task.c</a>.</p>

<p class="reference">References <a class="el" href="housekeeping__service_8c_source.html#l00097">HK_Get_Buffer()</a>, <a class="el" href="housekeeping__service_8c_source.html#l00069">HK_Get_Config()</a>, <a class="el" href="housekeeping__service_8c_source.html#l00087">HK_Get_Refresh_Time()</a>, and <a class="el" href="housekeeping__service_8c_source.html#l00044">HK_Service_Setup()</a>.</p>

<p class="reference">Referenced by <a class="el" href="sbcda__decoder__app_8c_source.html#l00031">sbcda_decoder_app()</a>.</p>

</div>
</div>
<a id="ga85a0f311d8c7082245c3308cd9161e46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga85a0f311d8c7082245c3308cd9161e46">&#9670;&nbsp;</a></span>Idle_Task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Idle_Task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dummy task created for checking if RTOS is alive. The task simple blink SF2 board LEDs. </p>
<p>Idle_Task</p>
<hr/>
 <h2>Idle_Task </h2>
<pre class="fragment">Dummy task created for checking if RTOS is alive
The task simple blink SF2 board LEDs.
This task is responsible for reloading the WDT
counter.</pre> 
<p class="definition">Definition at line <a class="el" href="idle__task_8c_source.html#l00031">31</a> of file <a class="el" href="idle__task_8c_source.html">idle_task.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="sbcda__decoder__app_8c_source.html#l00031">sbcda_decoder_app()</a>.</p>

</div>
</div>
<a id="gadfbb515047e6c4c679611a5cc618b88c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadfbb515047e6c4c679611a5cc618b88c">&#9670;&nbsp;</a></span>PTTDecoder_Task()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PTTDecoder_Task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>pvParameters</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>PTTDecoder_Task</p>
<p>The PTT Decoding task is responsible for coordinating the decoding process of newly detected PTT signals, as much as building PTT Packages. It rellies on services provided by the PTT Service and the DDS Layers. The PTT task runs in cycles of 10 ms, called windows. During each window the task performs the following activities: </p><pre>
  1.    Run a Detection Loop to identify new PTT signals;
  2.    Send a Decoding Start Operation signal if there are any active decoders;
  3.    Run a Decoding Loop, procedure that adds new decoded bits to the currently building PTT Packages;
  4.    Check if the firmware has received a PTT_POP command and, in this case, update the pointer of the PTT Packages FIFO  ;
  5.    Wait until the next window starts.
</pre><p> Steps 1 to 3 are executed in high priority mode. The task cannot be preempted during these steps. Together they last about 4ms (40% of the window time). During the remaining time, the PTT task runs in low priority mode, allowing other tasks to control the processor. An interrupt signal is generated on GPIO_0 pin to trigger a new window. When this interruption is detected the system is forced to reenter the high priority state and restart the decoding process. The on-board computer can pause or resume the decoding process by using the PTT_PAUSE and PTT_RESUME commands in Configuration Mode. When the decoder is paused steps 1, 2 and 3 are not executed.</p>
<p>PTTDecoder_Task </p>

<p class="definition">Definition at line <a class="el" href="ptt__task_8c_source.html#l00039">39</a> of file <a class="el" href="ptt__task_8c_source.html">ptt_task.c</a>.</p>

<p class="reference">References <a class="el" href="dds_8c_source.html#l00075">DDS_clearNewWindowFlag()</a>, <a class="el" href="dds_8c_source.html#l00669">DDS_Detection_Loop()</a>, <a class="el" href="dds_8c_source.html#l00160">DDS_EnableDecoder()</a>, <a class="el" href="dds_8c_source.html#l00068">DDS_isNewWindowReady()</a>, <a class="el" href="dds_8c_source.html#l00035">DDS_Setup()</a>, <a class="el" href="ptt__service_8c_source.html#l00164">PTT_Service_isPaused()</a>, and <a class="el" href="ptt__service_8c_source.html#l00097">PTT_Service_Setup()</a>.</p>

<p class="reference">Referenced by <a class="el" href="sbcda__decoder__app_8c_source.html#l00031">sbcda_decoder_app()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
